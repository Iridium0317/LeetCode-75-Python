import os
import json

# å®šä¹‰è¡¨å¤´å’Œä»‹ç»æ–‡æ¡ˆ
header = """# LeetCode 75 - Jupyter Notebook Edition ğŸ““

This repository contains my solutions for the LeetCode 75 study plan. 
I use a **"Solve-then-Review"** methodology using Jupyter Notebooks.

## ğŸ§  Study Methodology: Spaced Repetition

- **Day 1 (Implementation)**: Focus on solving the problem and passing test cases.
- **Day 2 (Retrospection)**: Revisit the solution after 24 hours to write **Takeaways**, analyze complexity, and optimize code.

---

## ğŸ“Š Progress Tracker

| Category | Problem | ğŸ’» Day 1: Code | ğŸ“ Day 2: Takeaways |
| :--- | :--- | :---: | :---: |
"""

footer = """
---
*Auto-generated by script. Happy Coding!*
"""

def analyze_notebook(filepath):
    try:
        with open(filepath, 'r', encoding='utf-8') as f:
            data = json.load(f)
            
        cells = data.get("cells", [])
        
        # 1. æ£€æµ‹ä»£ç  (Day 1)
        # å‡è®¾ä»£ç åœ¨ç¬¬2ä¸ªCell (Index 1)
        code_status = "â¬œ"
        if len(cells) > 1 and cells[1]['cell_type'] == 'code':
            source = "".join(cells[1]['source']).strip()
            # å¦‚æœä»£ç é•¿åº¦å¤§äº 50 ä¸”ä¸åŒ…å« "pass" (ä¸”ä¸ä»…æ˜¯ç©ºçš„)ï¼Œè®¤ä¸ºå·²å†™
            if len(source) > 50 and "pass" not in source:
                code_status = "âœ…"

        # 2. æ£€æµ‹ç¬”è®° (Day 2)
        # å‡è®¾ç¬”è®°åœ¨ç¬¬3ä¸ªCell (Index 2)
        note_status = "â¬œ"
        if len(cells) > 2 and cells[2]['cell_type'] == 'markdown':
            source = "".join(cells[2]['source'])
            # æ£€æµ‹æ˜¯å¦å‹¾é€‰äº† [x] æˆ–è€…ç¬”è®°å­—æ•°æ˜¾è‘—å¢åŠ 
            if "[x]" in source:
                note_status = "âœ…"
            elif code_status == "âœ…":
                # å¦‚æœå†™äº†ä»£ç ä½†æ²¡å‹¾é€‰ç¬”è®°ï¼Œæ˜¾ç¤ºç­‰å¾…ä¸­
                note_status = "â³"
        
        return code_status, note_status
    except Exception as e:
        return "âš ï¸", "âš ï¸"

# ä¸»é€»è¾‘
content = header
total_solved = 0
total_reviewed = 0

# æŒ‰æ–‡ä»¶åæ’åºï¼Œä¿è¯é¡ºåºä¸€è‡´
for root, dirs, files in os.walk("."):
    dirs.sort() # ç¡®ä¿ 01, 02... é¡ºåº
    if ".git" in root or ".ipynb_checkpoints" in root:
        continue
        
    category = os.path.basename(root)
    # åªè¦ 01-22 å¼€å¤´çš„æ–‡ä»¶å¤¹
    if not category[0].isdigit():
        continue
        
    # å¤„ç†è¯¥åˆ†ç±»ä¸‹çš„æ–‡ä»¶
    files.sort()
    # è¿™ä¸€è¡Œæ˜¯ä¸ºäº†åªæ˜¾ç¤ºåˆ†ç±»åç§°ä¸€æ¬¡ï¼Œåšä¸ªæ ‡è®°
    first_in_category = True
    
    clean_category_name = category.replace("_", " ")
    
    for file in files:
        if file.endswith(".ipynb"):
            filepath = os.path.join(root, file)
            
            # è§£æé¢˜ç›®å (å»æ‰ ID å’Œ åç¼€)
            # 1768_Merge_Strings.ipynb -> Merge Strings
            try:
                raw_name = file.replace(".ipynb", "")
                parts = raw_name.split("_")
                if parts[0].isdigit():
                    display_name = " ".join(parts[1:])
                    problem_id = parts[0]
                    full_display = f"**{problem_id}.** {display_name}"
                else:
                    full_display = raw_name
            except:
                full_display = file

            # åˆ†æçŠ¶æ€
            c_stat, n_stat = analyze_notebook(filepath)
            
            if c_stat == "âœ…": total_solved += 1
            if n_stat == "âœ…": total_reviewed += 1
            
            # åªæœ‰å½“åˆ†ç±»ç¬¬ä¸€æ¬¡å‡ºç°æ—¶æ˜¾ç¤ºåå­—ï¼Œåé¢ç•™ç©ºï¼Œä¿æŒè¡¨æ ¼æ•´æ´
            cat_col = f"**{clean_category_name}**" if first_in_category else ""
            
            # ç”Ÿæˆè¿åˆ° Notebook çš„é“¾æ¥
            link = f"[{full_display}](./{category}/{file})"
            
            content += f"| {cat_col} | {link} | {c_stat} | {n_stat} |\n"
            first_in_category = False

# å†™å…¥ README
with open("README.md", "w", encoding="utf-8") as f:
    f.write(content + footer)

print(f"âœ… README updated! Solved: {total_solved}, Reviewed: {total_reviewed}")
